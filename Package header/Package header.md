# 4.包头数据格式

包头数据包含数据来源和流向，以及设备类型和协议版本等信息，它与数据域、包校验一起组成PHY1层数据包。

| 参数                        | 数据长度 | 默认值 | 描述                                                         |
| --------------------------- | -------- | ------ | ------------------------------------------------------------ |
| 屏地址(DstAddr )            | 2        | 0x0001 | 屏地址。<br />在 PHY 层，广播地址定义如下：<br />0xFFFF为广播地址1，此种模式下，控制器不返回数据，其可用于广播校时等命令。0xFFFE为广播地址2，此种模式主要用于广播设置屏参，控制器需返回数据。在返回的数据帧中，地址也应为0XFFFE。<br />0x8000~0xDFFF地址为保留地址，对于物理层类型为TCP/IP或GPRS这种不需要处理DstAddr的，可将其目标地址设置为这个范围中的一个，默认设置地址为0x8000。 |
| 源地址(SrcAddr)             | 2        | 0x8000 | 源地址，几个特殊地址定义如下：<br />PC客户端软件从 0x8000开始，范围为0x8000——0xDFFF，用来代表不同客户端软件；0xE000——0xFFFE为保留地址。 |
| 保留(Reserved)              | 3        | 0x00   | 此处保留。                                                   |
| 条码选项（BarCode Option）  | 1        | 0x00   | 当该字节的BIT0为1时，需要发送接下来的16字节BarCode，这么做是为了便于在线设置控制器IP.反之，当该字节的BIT0为0时，不需要发送接下来的16字节BarCode.（该字节仅限6K（YY），其他类型控制卡请设置为0）<br />注意：<br />1. 只有设置IP命令需要将该字节的BIT0设置为1；<br />2. 上位机需要通过网络搜索命令来获取当前局域网内所有控制卡的BarCode |
| 条码（BarCode）             | 16       |        | 注意：16字节的条码在生产时由生产部门烧写进控制器，控制器 APP 需要在程序中读取出该 16 字节条码，当BarCode Option 字节的 BIT0 为 1 时，与上位机下发的条码值进行比较，如果完全相同，则接受该数据包，否则丢弃之。（仅6K（YY）适用） |
| 校验模式（CheckMode）       | 1        | 0x00   | 校验值共两个字节，<br />当该字节为0时，采用CRC16方式；<br />当该字节为1时，采用和校验的方式，仅保留最低位两个字节，采用小端模式；<br />当该字节为2时（仅6K（YY适用）），无校验，校验字节可以为任意值； |
| 显示模式(DisplayMode)       | 1        | 0x00   | 0x00：普通模式，动态区与节目可同时显示，但各区域不可重叠。<br/>0x01：动态模式，优先显示动态区，无动态区则显示节目，动态区与节目区可重叠。<br />注：特殊动态区不支持动态模式。 |
| 设备类型(DeviceType)        | 1        | 0x51   | 用于区分网络中不同的设备类型，定义如下：<br/>0xFE——通配符<br />0x51——BX-5K1<br />0x58——BX-5K2<br />0x53——BX-5MK2<br />0x54——BX-5MK1<br />0x61——BX-6K1   与5K1 (0x51)兼容<br />0x62——BX-6K2   与5MK1 (0x54)  兼容<br />0x63——BX-6K3   与5K2,5MK2 (0x53/0x58)兼容<br />0x64——BX-6K1-YY<br />0x65——BX-6K2-YY<br />0x66——BX-6K3-YY |
| 协议版本号(ProtocolVersion) | 1        | 0x02   | 协议版本号，用于区分控制卡使用的协议                         |
| 数据域长度(DataLen)         | 2        | 0x00   | 数据域的长度（不包括帧头、帧尾、帧校验和包头）。             |

#### 示例：

卡型号6K3,128*32屏，手动换行，多行显示，显示内容：“欢迎光临”，字体大小16X16

a5 a5 a5 a5 a5 a5 a5 a5 **fe ff 00 80 00 00 00 00 00 00 fe 02 2c 00** a3 06 01 00 00 00 01 23 00 00 00 80 00 00 80 80 20 00 00 00 00 0a 00 00 00 00 02 01 01 00 02 0a 08 00 00 00 bb b6 d3 ad b9 e2 c1 d9 3c 49 5a

示例中加粗部分为包头解析

| 参数       | 数据   | 描述       |
| ---------- | ------ | ---------- |
| 屏地址     | FFFE   | 也是屏号   |
| 源地址     | 8000   | 源地址     |
| 保留字节   | 000000 | 保留字节   |
| 是否有条码 | 00     | 无条码     |
| 校验模式   | 00     | CRC16校验  |
| 显示模式   | 00     | 普通模式   |
| 设备类型   | FE     | 通配符     |
| 协议版本号 | 02     | 协议版本号 |
| 数据域长度 | 002C   | 数据域长度 |